{
  "createdAt": "2025-04-12T17:10:48.887Z",
  "updatedAt": "2025-06-09T23:04:31.362Z",
  "id": "sOmHqbDcZ410M5F2",
  "name": "My workflow 3",
  "active": false,
  "isArchived": true,
  "nodes": [
    {
      "parameters": {
        "mode": "insert",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1.1,
      "position": [
        -564,
        -260
      ],
      "id": "8a0e71f3-0c14-44bd-a6d7-26c0a374dcbc",
      "name": "Postgres PGVector Store",
      "credentials": {
        "postgres": {
          "id": "kQzgcNa1COjXdT04",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        -580,
        -40
      ],
      "id": "0fdaacac-05b8-4fa3-9eec-ca1d37a68ad8",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "E2kIPBw3otjaqfbR",
          "name": "VALIDACAO_PABLO"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1,
      "position": [
        -460,
        -37.5
      ],
      "id": "fcabb76c-a1fa-4206-ae3b-e2ef28fd2737",
      "name": "Default Data Loader"
    },
    {
      "parameters": {
        "chunkSize": 500,
        "chunkOverlap": 50,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        -372,
        160
      ],
      "id": "3b4dde29-6628-48b5-b0af-d7928077222e",
      "name": "Recursive Character Text Splitter"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1020,
        -260
      ],
      "id": "f07c3861-4dbf-464e-9ef3-3ac428cf1902",
      "name": "When clicking ‚ÄòTest workflow‚Äô"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "725ea266-53f6-403d-abdf-3076b9738d60",
              "name": "menu",
              "value": "=Sabor da Terra - Menu Principal\n\n1. Picanha na Chapa\n   Quantidade: 300g\n   Ingredientes: Picanha fatiada, alho dourado, farofa de ovos, vinagrete e arroz branco.\n   Valor: R$ 59,90\n\n2. Risoto de Camar√£o Cremoso\n   Quantidade: 350g\n   Ingredientes: Arroz arb√≥rio, camar√µes m√©dios, creme de leite fresco, queijo parmes√£o e ervas finas.\n   Valor: R$ 47,00\n\n3. Frango ao Molho de Maracuj√°\n   Quantidade: 250g\n   Ingredientes: Fil√© de frango grelhado, molho de maracuj√°, arroz branco e batatas r√∫sticas.\n   Valor: R$ 39,90\n\n4. Til√°pia Grelhada com Pur√™ de Banana-da-Terra\n   Quantidade: 280g\n   Ingredientes: Fil√© de til√°pia, pur√™ cremoso de banana-da-terra e legumes salteados.\n   Valor: R$ 42,00\n\n5. Costela Bovina Assada\n   Quantidade: 400g\n   Ingredientes: Costela lentamente assada, mandioca cozida na manteiga e arroz tropeiro.\n   Valor: R$ 54,90\n\n6. Moqueca de Peixe Baiana\n   Quantidade: 350g\n   Ingredientes: Fil√© de peixe, leite de coco, azeite de dend√™, piment√µes e coentro.\n   Valor: R$ 49,90\n\n7. Macarr√£o √† Carbonara Caipira\n   Quantidade: 300g\n   Ingredientes: Espaguete, creme de leite, bacon crocante, queijo coalho e ovos caipiras.\n   Valor: R$ 36,00\n\n8. Nhoque de Mandioquinha ao Sugo R√∫stico\n   Quantidade: 280g\n   Ingredientes: Nhoque artesanal de mandioquinha, molho de tomate caseiro e manjeric√£o fresco.\n   Valor: R$ 33,50\n\n9. Hamb√∫rguer da Terra\n   Quantidade: 200g\n   Ingredientes: P√£o brioche, hamb√∫rguer de costela, queijo da canastra, cebola caramelizada e r√∫cula.\n   Valor: R$ 29,90\n\n10. Escondidinho de Carne Seca com Queijo Coalho\n    Quantidade: 300g\n    Ingredientes: Carne seca desfiada, pur√™ de mandioca e cobertura gratinada de queijo coalho.\n    Valor: R$ 38,00\n\n11. Fil√© Mignon ao Molho Madeira\n    Quantidade: 250g\n    Ingredientes: Medalh√µes de fil√© mignon, molho madeira com cogumelos, arroz com br√≥colis e batata palha.\n    Valor: R$ 58,00\n\n12. Galinhada Goiana\n    Quantidade: 350g\n    Ingredientes: Arroz temperado, peda√ßos de frango caipira, pequi, a√ßafr√£o e cheiro-verde.\n    Valor: R$ 41,90\n\n13. Lasanha de Berinjela com Ricota\n    Quantidade: 300g\n    Ingredientes: Camadas de berinjela grelhada, ricota temperada, molho de tomate e parmes√£o.\n    Valor: R$ 34,00\n\n14. Bai√£o de Dois Sertanejo\n    Quantidade: 350g\n    Ingredientes: Arroz, feij√£o verde, carne de sol, queijo coalho, bacon e cheiro-verde.\n    Valor: R$ 38,50\n\n15. Paella Caipira\n    Quantidade: 400g\n    Ingredientes: Arroz temperado, frango, lingui√ßa, milho, piment√µes e a√ßafr√£o.\n    Valor: R$ 45,00\n\n16. Tutu √† Mineira Completo\n    Quantidade: 300g\n    Ingredientes: Feij√£o batido, farinha de mandioca, torresmo, couve refogada e ovo frito.\n    Valor: R$ 33,00\n\n17. Arroz de Polvo do Cerrado\n    Quantidade: 350g\n    Ingredientes: Arroz cremoso com polvo, tomate, cebola roxa, lim√£o e coentro.\n    Valor: R$ 55,90\n\n18. Til√°pia ao Molho de Alcaparras\n    Quantidade: 280g\n    Ingredientes: Fil√© de til√°pia grelhado, molho de alcaparras, arroz de alho e legumes cozidos.\n    Valor: R$ 44,00\n\n19. Estrogonofe de Carne com Batata Palha\n    Quantidade: 300g\n    Ingredientes: Iscas de carne, creme de leite, ketchup artesanal, champignon, arroz branco.\n    Valor: R$ 35,90\n\n20. Polenta Cremosa com Ragu de Costela\n    Quantidade: 350g\n    Ingredientes: Polenta de milho amarelo, costela desfiada ao molho escuro e parmes√£o ralado.\n    Valor: R$ 39,50\n",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -800,
        -260
      ],
      "id": "6768c365-6676-42f1-ae2c-c3ac8613c7c2",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "teste",
        "options": {
          "systemMessage": "Voc√™ √© um atendente virtual do restaurante *Sabor da Terra*.  \nSeu papel √© responder perguntas sobre o card√°pio de forma **clara**, **objetiva** e **educada**.\n\nO conte√∫do completo do menu j√° foi processado e vetorizado. Sempre baseie suas respostas nas informa√ß√µes recuperadas.\n\nüîπ **Regras importantes:**\n- Seja direto e √∫til.\n- Priorize **qualidade e precis√£o**, mesmo que leve mais tokens para raciocinar.\n- **Evite respostas longas ou gen√©ricas.**\n- **N√£o invente pratos, ingredientes ou pre√ßos.**\n- Responda **apenas o que foi perguntado**.\n- Se a pergunta n√£o tiver rela√ß√£o com o card√°pio, diga que voc√™ s√≥ pode responder sobre os pratos do restaurante.\n\nSe a pergunta envolver compara√ß√µes de pre√ßos, quantidades ou listagens completas, use a ferramenta ListarTodosOsPratos para recuperar todos os dados e fazer o racioc√≠nio com base nessa resposta."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        -444,
        -1120
      ],
      "id": "ec07a0e8-c4be-4e23-91a4-194bfced6b4a",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -1020,
        -1380
      ],
      "id": "9b08e636-ac6d-40b9-8820-515f75341b83",
      "name": "When chat message received",
      "webhookId": "6a8a0e33-5299-4710-9c07-5f57119904a0",
      "disabled": true
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4-turbo",
          "mode": "list",
          "cachedResultName": "gpt-4-turbo"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -580,
        -900
      ],
      "id": "dc23c6ee-6f22-4078-add7-e23a119f4f60",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "E2kIPBw3otjaqfbR",
          "name": "VALIDACAO_PABLO"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "menu",
        "toolDescription": "Utilize para pesquisar o menu",
        "includeDocumentMetadata": false,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1.1,
      "position": [
        -340,
        -897.5
      ],
      "id": "3255cb78-0d95-42e0-a04e-c075deefa6df",
      "name": "Postgres PGVector Store1",
      "credentials": {
        "postgres": {
          "id": "kQzgcNa1COjXdT04",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        -252,
        -700
      ],
      "id": "2c240084-bfa5-4359-a967-ad3d87c51dea",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "E2kIPBw3otjaqfbR",
          "name": "VALIDACAO_PABLO"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -460,
        -900
      ],
      "id": "25311a99-112f-48cb-a2cc-dac05155103a",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "name": "ListarTodosOsPratos",
        "jsCode": "// Menu tokenizado\nconst menu = [\n  { nome: \"picanha na chapa\", valor: 59.90 },\n  { nome: \"risoto camar√£o cremoso\", valor: 47.00 },\n  { nome: \"frango ao molho maracuj√°\", valor: 39.90 },\n  { nome: \"til√°pia grelhada pur√™ banana terra\", valor: 42.00 },\n  { nome: \"costela bovina assada\", valor: 54.90 },\n  { nome: \"moqueca peixe baiana\", valor: 49.90 },\n  { nome: \"macarr√£o √† carbonara caipira\", valor: 36.00 },\n  { nome: \"nhoque mandioquinha sugo r√∫stico\", valor: 33.50 },\n  { nome: \"hamb√∫rguer terra\", valor: 29.90 },\n  { nome: \"escondidinho carne seca queijo coalho\", valor: 38.00 },\n  { nome: \"fil√© mignon molho madeira\", valor: 58.00 },\n  { nome: \"galinhada goiana\", valor: 41.90 },\n  { nome: \"lasanha berinjela ricota\", valor: 34.00 },\n  { nome: \"bai√£o dois sertanejo\", valor: 38.50 },\n  { nome: \"paella caipira\", valor: 45.00 },\n  { nome: \"tutu mineira completo\", valor: 33.00 },\n  { nome: \"arroz polvo cerrado\", valor: 55.90 },\n  { nome: \"til√°pia molho alcaparras\", valor: 44.00 },\n  { nome: \"estrogonofe carne batata palha\", valor: 35.90 },\n  { nome: \"polenta cremosa ragu costela\", valor: 39.50 }\n];\n\nconst listaFormatada = menu\n  .map(prato => `- ${prato.nome} ‚Äî R$ ${prato.valor.toFixed(2)}`)\n  .join('\\n');\n\nreturn `Menu resumido com nomes e pre√ßos:\\n\\n${listaFormatada}`;"
      },
      "type": "@n8n/n8n-nodes-langchain.toolCode",
      "typeVersion": 1.1,
      "position": [
        -44,
        -900
      ],
      "id": "e07fb332-385b-45db-bc47-19665efb06ad",
      "name": "Code Tool"
    },
    {
      "parameters": {
        "updates": [
          "messages"
        ],
        "options": {}
      },
      "type": "n8n-nodes-base.whatsAppTrigger",
      "typeVersion": 1,
      "position": [
        -1020,
        -920
      ],
      "id": "3a5915ee-1016-477b-b976-a568774e4639",
      "name": "WhatsApp Trigger",
      "webhookId": "eb23b8ce-a240-474c-83ce-a2bbfee790fc",
      "credentials": {
        "whatsAppTriggerApi": {
          "id": "Hyuvm06E2gToeIlN",
          "name": "WhatsApp OAuth account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 1
          },
          "conditions": [
            {
              "id": "8a765e57-8e39-4547-a99a-0458df2b75f4",
              "operator": {
                "type": "object",
                "operation": "exists",
                "singleValue": true
              },
              "leftValue": "={{ $json.messages[0] }}",
              "rightValue": ""
            }
          ],
          "combinator": "and"
        },
        "options": {
          "looseTypeValidation": true
        }
      },
      "id": "f46ad22d-1118-4f14-9da6-91f857d637ed",
      "name": "Is message?",
      "type": "n8n-nodes-base.if",
      "position": [
        -800,
        -920
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "={{ $('Is message?').item.json.metadata.phone_number_id }}",
        "recipientPhoneNumber": "={{ $('Is message?').item.json.contacts[0].wa_id }}",
        "textBody": "={{ $json.output }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        156,
        -920
      ],
      "id": "ba32cb73-e6e5-4789-908d-cc913ae9863a",
      "name": "WhatsApp Business Cloud1",
      "webhookId": "571318e8-35ae-4a53-80d8-59b6a5649ae9",
      "credentials": {
        "whatsAppApi": {
          "id": "fsDXKfeMv1tVvrBU",
          "name": "PH-PROD"
        }
      }
    }
  ],
  "connections": {
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Postgres PGVector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Postgres PGVector Store",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‚ÄòTest workflow‚Äô": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Postgres PGVector Store",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        []
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres PGVector Store1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Postgres PGVector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Code Tool": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "WhatsApp Trigger": {
      "main": [
        [
          {
            "node": "Is message?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is message?": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "WhatsApp Business Cloud1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "WhatsApp Trigger": [
      {
        "json": {
          "messaging_product": "whatsapp",
          "metadata": {
            "display_phone_number": "556136866201",
            "phone_number_id": "662809173574386"
          },
          "statuses": [
            {
              "id": "wamid.HBgMNTU2MjgxMTU0MTIwFQIAERgSOTc2Qjg0NUE1MzFERERGQUFGAA==",
              "status": "delivered",
              "timestamp": "1744409773",
              "recipient_id": "556281154120",
              "conversation": {
                "id": "40319d04b4705709a945469449c32b94",
                "origin": {
                  "type": "utility"
                }
              },
              "pricing": {
                "billable": true,
                "pricing_model": "CBP",
                "category": "utility"
              }
            }
          ],
          "field": "messages"
        }
      }
    ]
  },
  "versionId": "de37da1f-b291-4838-9fd0-a17ed21a70bc",
  "triggerCount": 1,
  "tags": []
}